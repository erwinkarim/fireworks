<div class="page-header">
  <h1>Report Schedule</h1>
</div>

<div class="row">
  <div class="span12">
      <table class="table table-bordered pull-left" style="width:20%">
        <thead>
          <th>Name</th>
        </thead>
        <tbody id="schedules">
          <% @schedules.each do |schedule| %>
            <tr id="<%= schedule.id %>">
              <td><%= link_to schedule.title, '#', :schedule_id => schedule.id, :class=>'schedule'  %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <table id="reports-listing" class="table table-bordered pull-left" style="width:30%; visibility:hidden">
        <thead>
          <tr>
            <th>Reports</th>
            <th><%= button_tag 'Generate', :type => 'button', :class=> 'btn btn-primary btn-mini', 
              :id=> 'generate-report' %></th>
          </tr>
        </thead>
        <tbody id="reports-detail-body">
        </body>
      </table>
  </div>
</div>

<%= content_for :other_javascript do %>
<script type="text/javascript">
  //if the 

  $('.schedule').click( function(e){
    e.preventDefault();

    //highlight selected table
    $('#schedules').find('.info').removeClass('info');
    $(this).closest('tr').addClass('info');
    $('#reports-listing').css('visibility', 'visible');

    $.getJSON( '/reports/schedule/' + $(this).attr('schedule_id') + '/reports', function(data){
      
      //clear table and repopulate
      //adding the reports data as you go
      $('#reports-detail-body').empty();
      $.each( data, function(key,value) {
        $('#reports-detail-body').append( 
          $('<tr/>').append( 
            $('<td/>', { colspan:2 } ).append( 
              $('<a/>', {text:value.created_at, href:'/reports/'+value.id} ) 
            ).append(
              $.parseHTML(' | ')
            ).append(
              $('<a/>', {text:'CSV', href:'/reports/'+value.id + '.csv'} ) 
            ).append(
              $.parseHTML(' | ')
            ).append(
              $('<a/>', {text:'XLS', href:'/reports/'+value.id + '.xls'} ) 
            ) 
          )
        )
      }); 
      
    });
  
  });

  
</script>
<% end %>
